<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BlokeksCube+</title>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  display: flex;
  height: 100vh;
}

header {
  position: fixed;
  top: 0;
  width: 100%;
  background: #111;
  color: white;
  padding: 8px;
  font-weight: bold;
}

#palette {
  width: 180px;
  background: #eee;
  padding: 60px 10px 10px;
  border-right: 2px solid #ccc;
}

.block {
  background: #0b3d91;
  color: white;
  padding: 8px;
  margin: 6px 0;
  cursor: grab;
  border-radius: 8px;
  font-weight: bold;
}

.block:hover { background: #1456c4; }

#workspace {
  flex: 1;
  padding: 60px 10px 10px;
  background: #fafafa;
  overflow-y: auto;
}

button { padding: 6px; margin: 3px; }

canvas {
  border: 2px solid #333;
  background: white;
}

#stage { position: fixed; right: 10px; bottom: 10px; }
#designer { position: fixed; right: 10px; bottom: 330px; cursor: crosshair; }

#designerUI {
  position: fixed;
  right: 10px;
  bottom: 540px;
  background: #eee;
  padding: 6px;
}
</style>
</head>

<body>

<header>üßä BlokeksCube+ Engine</header>

<div id="palette">
<h3>Blocks</h3>

<div class="block" draggable="true" data-type="right">Move ‚Üí</div>
<div class="block" draggable="true" data-type="left">Move ‚Üê</div>
<div class="block" draggable="true" data-type="up">Move ‚Üë</div>
<div class="block" draggable="true" data-type="down">Move ‚Üì</div>
<div class="block" draggable="true" data-type="jump">Jump ‚Üí‚Üí</div>
<div class="block" draggable="true" data-type="reset">Reset</div>
<div class="block" draggable="true" data-type="wait">Wait</div>

<button onclick="runProgram()">‚ñ∂ Run</button>
<button onclick="clearProgram()">Clear</button>
</div>

<div id="workspace">
<h3>Program</h3>
</div>

<div id="designerUI">
<b>Costume Tools</b><br>
Color: <input type="color" id="colorPicker" value="#000000"><br>
Brush: <input type="range" id="brushSize" min="2" max="20" value="6"><br>
<button onclick="toggleEraser()">Eraser</button>
<button onclick="applyCostume()">Use Costume</button>
<button onclick="clearDesigner()">Clear</button>
</div>

<canvas id="designer" width="200" height="200"></canvas>
<canvas id="stage" width="300" height="300"></canvas>

<script>
/* ===== Drag Blocks ===== */

const workspace = document.getElementById("workspace");
const paletteBlocks = document.querySelectorAll(".block");
let program = [];

paletteBlocks.forEach(block => {
  block.addEventListener("dragstart", e =>
    e.dataTransfer.setData("type", block.dataset.type));
});

workspace.addEventListener("dragover", e => e.preventDefault());

workspace.addEventListener("drop", e => {
  const type = e.dataTransfer.getData("type");

  const el = document.createElement("div");
  el.className = "block";
  el.textContent = type;
  workspace.appendChild(el);

  program.push({ type });
});

function clearProgram() {
  workspace.innerHTML = "<h3>Program</h3>";
  program = [];
}

/* ===== Stage Engine ===== */

const canvas = document.getElementById("stage");
const ctx = canvas.getContext("2d");

let sprite = { x: 140, y: 140 };
let costumeImage = null;

function drawSprite() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if (costumeImage)
    ctx.drawImage(costumeImage, sprite.x, sprite.y, 40, 40);
  else {
    ctx.fillStyle="#0b3d91";
    ctx.fillRect(sprite.x, sprite.y, 20, 20);
  }
}

drawSprite();

function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

async function runProgram() {
  sprite = { x:140, y:140 };

  for (let cmd of program) {

    switch(cmd.type){

      case "right": sprite.x+=20; break;
      case "left": sprite.x-=20; break;
      case "up": sprite.y-=20; break;
      case "down": sprite.y+=20; break;
      case "jump": sprite.x+=40; break;

      case "reset":
        sprite={x:140,y:140};
        break;

      case "wait":
        await sleep(600);
        break;
    }

    drawSprite();
    await sleep(250);
  }
}

/* ===== Costume Designer ===== */

const designer=document.getElementById("designer");
const dctx=designer.getContext("2d");

let drawing=false;
let eraser=false;

designer.addEventListener("mousedown",()=>drawing=true);
designer.addEventListener("mouseup",()=>drawing=false);
designer.addEventListener("mouseleave",()=>drawing=false);

designer.addEventListener("mousemove",e=>{
  if(!drawing) return;

  const rect=designer.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;

  const size=document.getElementById("brushSize").value;

  if(eraser){
    dctx.clearRect(x,y,size,size);
  } else {
    dctx.fillStyle=document.getElementById("colorPicker").value;
    dctx.fillRect(x,y,size,size);
  }
});

function toggleEraser(){
  eraser=!eraser;
  alert(eraser?"Eraser ON":"Eraser OFF");
}

function applyCostume(){
  costumeImage=new Image();
  costumeImage.src=designer.toDataURL();
}

function clearDesigner(){
  dctx.clearRect(0,0,designer.width,designer.height);
}
</script>

</body>
</html>
